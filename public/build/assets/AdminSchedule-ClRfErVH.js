import{c as o,o as n,a as d,w as v,d as D,I as V,m as x,e as U,z as Z,g as q,u as G,Z as I,f as e,t as m,F as k,K as A,k as j,b as $,P as J,l as Q,H as X,a6 as Y}from"./app-BpzujhOZ.js";import{_ as T}from"./Card-CfWD_u_-.js";import{_ as ee}from"./AuthenticatedLayout-D1jPPGAS.js";import{_ as te}from"./NavLink-DBAWSDrX.js";import{_ as M}from"./FlexButton-Kd8b2R3p.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"space-x-8 rtl:space-x-reverse sm:flex"},le={__name:"ScheduleTabs",setup(N){return(f,_)=>(n(),o("div",ae,[d(te,{href:f.route("schedule.admin"),active:f.route().current("schedule.admin")},{default:v(()=>_[0]||(_[0]=[D(" Schedule ")])),_:1,__:[0]},8,["href","active"])]))}},oe={class:"py-6"},ne={class:"max-w-5xl mx-auto sm:px-4 lg:px-6"},re={class:"flex justify-between items-center px-2"},ie={class:"font-bold text-lg text-white tracking-wide shadow-red-500/50 drop-shadow-lg"},de={class:"px-2 pb-4 overflow-x-auto"},ue={class:"w-full border-separate border-spacing-y-2"},ce={class:"py-2 px-2 align-middle"},fe={class:"w-full h-16 flex flex-col items-center justify-center rounded-xl transition-all duration-300 bg-white/5 border border-white/5 text-gray-200 group-hover:bg-white/10 group-hover:border-white/20",style:{width:"100px"}},me={class:"text-xs font-bold uppercase text-red-400"},pe={class:"text-xl font-bold"},he=["onClick","title"],xe={key:0,class:"flex flex-col items-center justify-center w-full px-2"},ve={class:"text-white font-semibold text-xs text-center line-clamp-2 leading-tight"},ge={key:1,class:"flex flex-col items-center justify-center w-full group-hover:scale-110 transition-transform duration-300"},be={class:"flex justify-end mt-8 space-x-4 border-t border-white/10 pt-6"},ye=["disabled"],we=["disabled"],_e={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},ke={class:"bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md relative animate-fadeIn border border-gray-700"},Ye=["disabled"],Me={class:"text-2xl font-bold mb-6 text-gray-100 text-center"},De={class:"text-base font-medium text-gray-400"},Se={key:0,class:"flex flex-col items-center justify-center py-8"},Ce={key:1,class:"mb-6"},Ae=["disabled"],je=["value"],Ne={__name:"AdminSchedule",props:{staffList:{type:Array,default:()=>[]},leaveList:{type:Array,default:()=>[]}},setup(N){const f=N;console.log("staffList:",f.staffList);const _=["Morning","Night"],P=["morning","evening"],W=V().startOf("week").add(1,"day"),r=x(W),g=x(null),b=x(null),i=x(!1),c=x({}),y=x(""),p=x(!1);async function h(){const a=r.value.format("YYYY-MM-DD"),{data:t}=await Y.get("/schedule/week",{params:{week_start:a}});c.value=t.assignments||{},p.value=t.submitted||!1}U(h),Z(r,h);const z=q(()=>Array.from({length:7},(a,t)=>r.value.add(t,"day")));function B(a,t){g.value=a,b.value=t,c.value[a.format("YYYY-MM-DD")]||(c.value[a.format("YYYY-MM-DD")]=[null,null]),y.value=c.value[a.format("YYYY-MM-DD")][t]||""}function S(){i.value||(g.value=null,b.value=null)}async function F(){i.value=!0;const a=y.value,t=g.value.format("YYYY-MM-DD"),s=r.value.format("YYYY-MM-DD");if(f.leaveList&&f.leaveList.some(u=>u.user_id==a&&u.start_date<=t&&(!u.end_date||u.end_date>=t))){i.value=!1,alert("This staff is on leave for the selected day. Please pick another staff.");return}if((c.value[t]||[null,null]).includes(a)){i.value=!1,alert("This staff is already assigned to another shift on this day. Please pick another staff.");return}let l=0;for(const[u,R]of Object.entries(c.value))u>=s&&u<=V(s).add(6,"day").format("YYYY-MM-DD")&&R.includes(a)&&l++;if(l>=6){i.value=!1,alert("This staff is already assigned to 6 days in this week. Please pick another staff.");return}await Y.post("/schedule/assign",{employee_id:a,shift_type:P[b.value],day:t}),await h(),i.value=!1,S()}function H(){r.value=r.value.subtract(1,"week"),h()}function K(){r.value=r.value.add(1,"week"),h()}async function O(){await Y.post("/schedule/submit-week",{week_start:r.value.format("YYYY-MM-DD")}),await h(),alert("Weekly schedule submitted successfully!")}function L(a,t){var l;const s=(l=c.value[a.format("YYYY-MM-DD")])==null?void 0:l[t],w=f.staffList.find(u=>u.id==s);return w?w.name:""}function C(a,t){var s;return!!((s=c.value[a.format("YYYY-MM-DD")])!=null&&s[t])}async function E(){confirm("Are you sure you want to reset all assignments for this week?")&&(await Y.post("/schedule/reset",{week_start:r.value.format("YYYY-MM-DD")}),c.value={},await h())}return(a,t)=>(n(),o(k,null,[d(G(I),{title:"Weekly Schedule"}),d(ee,null,{tabs:v(()=>[d(le)]),default:v(()=>[e("div",oe,[e("div",ne,[d(T,{variant:"glass",class:"!mt-0"},{default:v(()=>[e("div",re,[d(M,{text:"Previous",onClick:H,class:"!bg-white/5 !border-white/10 hover:!bg-white/10 text-white px-6 py-2 rounded-full font-bold text-sm transition-all"}),e("span",ie,m(r.value.format("MMM D, YYYY"))+" - "+m(r.value.add(6,"day").format("MMM D, YYYY")),1),d(M,{text:"Next",onClick:K,class:"!bg-white/5 !border-white/10 hover:!bg-white/10 text-white px-6 py-2 rounded-full font-bold text-sm transition-all"})])]),_:1}),d(T,{variant:"glass",class:"mt-6"},{default:v(()=>[e("div",de,[e("table",ue,[t[2]||(t[2]=e("thead",null,[e("tr",null,[e("th",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest py-4 px-4 text-left"},"Day"),e("th",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest py-4 text-center"},[D("Morning"),e("br"),e("span",{class:"text-[10px] text-gray-500"},"6:00 - 15:00")]),e("th",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest py-4 text-center"},[D("Night"),e("br"),e("span",{class:"text-[10px] text-gray-500"},"15:00 - 00:00")])])],-1)),e("tbody",null,[(n(!0),o(k,null,A(z.value,(s,w)=>(n(),o("tr",{key:w,class:"group"},[e("td",ce,[e("div",fe,[e("span",me,m(s.format("ddd")),1),e("span",pe,m(s.format("D")),1)])]),(n(),o(k,null,A([0,1],l=>e("td",{key:l,class:"py-2 px-2 align-middle"},[e("div",{class:j(["w-full h-16 flex items-center justify-center rounded-xl transition-all duration-300 border cursor-pointer relative backdrop-blur-md",C(s,l)?"bg-gradient-to-br from-green-500/20 to-emerald-900/40 border-green-500/30 hover:border-green-400/50 hover:shadow-lg hover:shadow-green-900/20":"bg-white/5 border-white/5 hover:bg-white/10 hover:border-white/20 text-gray-400",p.value?"opacity-50 cursor-not-allowed grayscale":""]),onClick:u=>p.value?null:B(s,l),title:C(s,l)?L(s,l):"Click to assign staff"},[C(s,l)?(n(),o("div",xe,[e("span",ve,m(L(s,l)),1)])):(n(),o("div",ge,t[1]||(t[1]=[e("span",{class:"text-2xl text-white/20 font-light mb-0 leading-none"},"+",-1),e("span",{class:"text-[10px] uppercase tracking-wider text-white/40 font-bold"},"Assign",-1)])))],10,he)])),64))]))),128))])]),e("div",be,[e("button",{onClick:E,disabled:p.value,class:"px-6 py-2 rounded-full font-bold text-sm text-gray-400 hover:text-white hover:bg-white/5 transition-all disabled:opacity-50"}," Reset Week ",8,ye),p.value?$("",!0):(n(),o("button",{key:0,onClick:O,disabled:p.value,class:"px-8 py-3 rounded-full font-bold text-sm text-white uppercase tracking-wider bg-gradient-to-r from-red-600 to-red-800 shadow-lg shadow-red-900/40 hover:shadow-red-600/40 hover:scale-105 active:scale-95 transition-all duration-300"}," Submit Schedule ",8,we))])])]),_:1}),d(J,{name:"fade"},{default:v(()=>[g.value!==null&&b.value!==null&&!p.value?(n(),o("div",_e,[e("div",ke,[e("button",{onClick:S,class:"absolute top-3 right-3 text-gray-400 hover:text-gray-200 text-xl font-bold",disabled:i.value},"Ã—",8,Ye),e("h2",Me,[D(" Assign "+m(_[b.value])+" Shift",1),t[3]||(t[3]=e("br",null,null,-1)),e("span",De,"for "+m(g.value.format("ddd, MMM D")),1)]),i.value?(n(),o("div",Se,t[4]||(t[4]=[e("svg",{class:"animate-spin h-10 w-10 text-red-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),e("span",{class:"text-red-400 font-semibold text-lg"},"Validating staff...",-1)]))):(n(),o("div",Ce,[t[6]||(t[6]=e("label",{class:"block text-sm font-semibold mb-2 text-gray-200"},"Select Staff",-1)),Q(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),class:"border-2 border-gray-700 focus:border-red-500 focus:ring-2 focus:ring-red-200 rounded-md px-3 py-2 w-full text-base transition shadow-sm outline-none bg-gray-900 text-gray-100",disabled:i.value,autofocus:""},[t[5]||(t[5]=e("option",{value:""},"Select Staff",-1)),(n(!0),o(k,null,A(f.staffList.filter(s=>s.id!==1),s=>(n(),o("option",{key:s.id,value:s.id},m(s.name),9,je))),128))],8,Ae),[[X,y.value]]),d(M,{text:"Assign",onClick:F,class:j("w-full text-white font-semibold py-2 rounded-md mt-4"),disabled:i.value||!y.value},null,8,["disabled"])])),d(M,{onClick:S,text:"Cancel",class:j("w-full text-gray-200 font-semibold py-2 rounded-md transition mt-2"),disabled:i.value},null,8,["disabled"])])])):$("",!0)]),_:1})])])]),_:1})],64))}},Be=se(Ne,[["__scopeId","data-v-caeb5ff7"]]);export{Be as default};
